Twisted version in use: 15.5.0
c2w.test.protocol.udp_server_test
  c2wUdpChatServerTestCase
    test_two_users_full_login_udp_server_test ... DEBUG:c2w.main.server_proxy:done building the server proxy
INFO:c2w.main.server_model:found movie configuration file, reading it
INFO:c2w.main.server_model:MAIN_INFO: Adding movie: title=Big Buck Bunny, address=224.1.1.1, port=1034, path= ./../../../Movies/Big_Buck_Bunny_small.ogv
DEBUG:c2w.main.movie:MOVIE_STORE (addMovie):  title=Big Buck Bunny, IP=127.0.0.1, port=1034
INFO:c2w.main.server_model:MAIN_INFO: Adding movie: title=Sintel - Trailer, address=224.1.1.3, port=1040, path= ./../../../Movies/sintel_trailer-480p.ogv
DEBUG:c2w.main.movie:MOVIE_STORE (addMovie):  title=Sintel - Trailer, IP=127.0.0.1, port=1040
INFO:c2w.main.server_model:MAIN_INFO: Adding movie: title=Battleship Potemkin, address=224.1.1.5, port=1070, path= ./../../../Movies/Battleship_Potemkin.ogv 
DEBUG:c2w.main.movie:MOVIE_STORE (addMovie):  title=Battleship Potemkin, IP=127.0.0.1, port=1070
INFO:c2w.main.server_model:MAIN_INFO: Adding movie: title=Great Guy, address=224.1.1.7, port=1090, path= ./../../../Movies/Great_Guy.ogv
DEBUG:c2w.main.movie:MOVIE_STORE (addMovie):  title=Great Guy, IP=127.0.0.1, port=1090
INFO:c2w.main.server_model:MAIN_INFO: Adding movie: title=The Night Before Christmas, address=224.1.1.9, port=1100, path= ./../../../Movies/TheNightBeforeChristmas.ogv
DEBUG:c2w.main.movie:MOVIE_STORE (addMovie):  title=The Night Before Christmas, IP=127.0.0.1, port=1100
DEBUG:c2w.main.movie:MOVIE_STORE (addMovie):  title=3 Days to Kill, IP=0.0.0.0, port=20000
DEBUG:c2w.main.lossy_transport:Initializing lossy transport with loss probability=0
DEBUG:c2w.protocol.udp_chat_server_protocol:Received message from ('127.0.0.1', 10000)
DEBUG:c2w.protocol.message:Received a Login request (len=10)
DEBUG:c2w.protocol.message:-> user name:frédéric
DEBUG:c2w.protocol.udp_chat_server_protocol:Message of type: Login
  ACK: False
  Seq_num: 0
    user_name: frédéric
    data_length: 10

DEBUG:c2w.protocol.udp_chat_server_protocol:Unknown remote address, creating a  c2wServerProtocol instance for address ('127.0.0.1', 10000)
DEBUG:c2w.protocol.stop_wait:Registering KeepAlive=<bound method c2wServerProtocol.keepAliveTimeOutOccured of <c2w.protocol.server.c2wServerProtocol object at 0x7f854371e8d0>>
DEBUG:c2w.protocol.server:
handlePacket
DEBUG:c2w.protocol.server:  message dump: b'0001000e6672c3a964c3a9726963'
DEBUG:c2w.protocol.message:Received a Login request (len=10)
DEBUG:c2w.protocol.message:-> user name:frédéric
DEBUG:c2w.protocol.server:received non-ack message
DEBUG:c2w.protocol.message:building ACK with ack_num=0 
DEBUG:c2w.protocol.message:Written header: b'00ff0004' (len=4)
DEBUG:c2w.protocol.message:Written header: b'00ff0004' (len=4)
DEBUG:c2w.protocol.stop_wait:ACK Message sent in UDP: len=4
DEBUG:c2w.protocol.stop_wait:  message dump: b'00ff0004'
DEBUG:c2w.protocol.server:handleNonAck
DEBUG:c2w.protocol.stop_wait:Received message with correct seq#=0
DEBUG:c2w.protocol.server:calling handleLoginRequest
DEBUG:c2w.main.user:USER_STORE (addUSer): adding user with name frédéric to the dictionary
DEBUG:c2w.protocol.server:Send user status (connection accept) to user frédéric (userId=1).
DEBUG:c2w.protocol.message:building Login OK message
DEBUG:c2w.protocol.message:Written header: b'00020004' (len=4)
DEBUG:c2w.protocol.message:Written header: b'00020004' (len=4)
DEBUG:c2w.protocol.stop_wait:sendMsg, empty queue, sending message with  wit seqNum=0 immediately
DEBUG:c2w.protocol.stop_wait:self.callLateId=<DelayedCall 0x7f854371eb00 [2.0s] called=0 cancelled=0 c2wStopAndWait.timeOut()>
DEBUG:c2w.protocol.stop_wait:Message sent in UDP: len=4
DEBUG:c2w.protocol.stop_wait:  message dump: b'00020004'
DEBUG:c2w.protocol.server:Building user list messages:
DEBUG:c2w.protocol.message:building user list
DEBUG:c2w.protocol.message:Written header: b'00110004' (len=4)
DEBUG:c2w.protocol.message:   user: frédéric   room=<class 'c2w.main.constants.ROOM_IDS.MAIN_ROOM'>   destRoom=<class 'c2w.main.constants.ROOM_IDS.MAIN_ROOM'>
DEBUG:c2w.protocol.message:   user: frédéric   payload_len=12
DEBUG:c2w.protocol.message:   number of users in list: 1
DEBUG:c2w.protocol.message:   len of userlist payload: 12
DEBUG:c2w.protocol.message:   m.buf: 4, m.msg_len 16
DEBUG:c2w.protocol.message:Written header: b'011100100a416672c3a964c3a9726963' (len=16)
DEBUG:c2w.protocol.stop_wait:sendMsg, current queue length=1, queueing  message wit seqNum=1
DEBUG:c2w.protocol.message:building movie list
DEBUG:c2w.protocol.message:   movie: 3 Days to Kill   payload_len=21
DEBUG:c2w.protocol.message:Written header: b'00120019000000000000000000000000000000000000000000' (len=25)
DEBUG:c2w.protocol.message:   number of movies in list: 1
DEBUG:c2w.protocol.message:   len of movielist payload: 21
DEBUG:c2w.protocol.message:   m.buf: 25, m.msg_len 25
DEBUG:c2w.protocol.message:Written header: b'021200190e000000004e2033204461797320746f204b696c6c' (len=25)
DEBUG:c2w.protocol.stop_wait:sendMsg, current queue length=2, queueing  message wit seqNum=2
DEBUG:c2w.protocol.udp_chat_server_protocol:Received message from ('127.0.0.1', 10000)
DEBUG:c2w.protocol.message:Received an Ack seq_num=0
DEBUG:c2w.protocol.udp_chat_server_protocol:Message of type: Acknoledgment
  ACK: True
  Seq_num: 0

DEBUG:c2w.protocol.server:
handlePacket
DEBUG:c2w.protocol.server:  message dump: b'00ff0004'
DEBUG:c2w.protocol.message:Received an Ack seq_num=0
DEBUG:c2w.protocol.server:received ack message
DEBUG:c2w.protocol.stop_wait:Received ACK for pkt #=0, OK
DEBUG:c2w.protocol.stop_wait:Non-empty queue, ACK reception  triggering tx of queued packet
DEBUG:c2w.protocol.stop_wait:self.callLateId=<DelayedCall 0x7f854371ea58 [2.0s] called=0 cancelled=0 c2wStopAndWait.timeOut()>
DEBUG:c2w.protocol.stop_wait:Message sent in UDP: len=4
DEBUG:c2w.protocol.stop_wait:  message dump: b'011100100a416672c3a964c3a9726963'
DEBUG:c2w.protocol.server:Building user list messages:
DEBUG:c2w.protocol.message:building user list
DEBUG:c2w.protocol.message:Written header: b'00110004' (len=4)
DEBUG:c2w.protocol.message:   user: frédéric   room=<class 'c2w.main.constants.ROOM_IDS.MAIN_ROOM'>   destRoom=<class 'c2w.main.constants.ROOM_IDS.MAIN_ROOM'>
DEBUG:c2w.protocol.message:   user: frédéric   payload_len=12
DEBUG:c2w.protocol.message:   number of users in list: 1
DEBUG:c2w.protocol.message:   len of userlist payload: 12
DEBUG:c2w.protocol.message:   m.buf: 4, m.msg_len 16
DEBUG:c2w.protocol.message:Written header: b'031100100a416672c3a964c3a9726963' (len=16)
DEBUG:c2w.protocol.stop_wait:sendMsg, current queue length=2, queueing  message wit seqNum=3
DEBUG:c2w.protocol.udp_chat_server_protocol:Received message from ('127.0.0.1', 10000)
DEBUG:c2w.protocol.message:Received an Ack seq_num=1
DEBUG:c2w.protocol.udp_chat_server_protocol:Message of type: Acknoledgment
  ACK: True
  Seq_num: 1

DEBUG:c2w.protocol.server:
handlePacket
DEBUG:c2w.protocol.server:  message dump: b'01ff0004'
DEBUG:c2w.protocol.message:Received an Ack seq_num=1
DEBUG:c2w.protocol.server:received ack message
DEBUG:c2w.protocol.stop_wait:Received ACK for pkt #=1, OK
DEBUG:c2w.protocol.stop_wait:Non-empty queue, ACK reception  triggering tx of queued packet
DEBUG:c2w.protocol.stop_wait:self.callLateId=<DelayedCall 0x7f854371ea90 [2.0s] called=0 cancelled=0 c2wStopAndWait.timeOut()>
DEBUG:c2w.protocol.stop_wait:Message sent in UDP: len=25
DEBUG:c2w.protocol.stop_wait:  message dump: b'021200190e000000004e2033204461797320746f204b696c6c'
DEBUG:c2w.protocol.udp_chat_server_protocol:Received message from ('127.0.0.1', 10000)
DEBUG:c2w.protocol.message:Received an Ack seq_num=2
DEBUG:c2w.protocol.udp_chat_server_protocol:Message of type: Acknoledgment
  ACK: True
  Seq_num: 2

DEBUG:c2w.protocol.server:
handlePacket
DEBUG:c2w.protocol.server:  message dump: b'02ff0004'
DEBUG:c2w.protocol.message:Received an Ack seq_num=2
DEBUG:c2w.protocol.server:received ack message
DEBUG:c2w.protocol.stop_wait:Received ACK for pkt #=2, OK
DEBUG:c2w.protocol.stop_wait:Non-empty queue, ACK reception  triggering tx of queued packet
DEBUG:c2w.protocol.stop_wait:self.callLateId=<DelayedCall 0x7f854371eb38 [2.0s] called=0 cancelled=0 c2wStopAndWait.timeOut()>
DEBUG:c2w.protocol.stop_wait:Message sent in UDP: len=4
DEBUG:c2w.protocol.stop_wait:  message dump: b'031100100a416672c3a964c3a9726963'
DEBUG:c2w.protocol.udp_chat_server_protocol:Received message from ('127.0.0.1', 10001)
DEBUG:c2w.protocol.message:Received a Login request (len=8)
DEBUG:c2w.protocol.message:-> user name:amédée
DEBUG:c2w.protocol.udp_chat_server_protocol:Message of type: Login
  ACK: False
  Seq_num: 0
    user_name: amédée
    data_length: 8

DEBUG:c2w.protocol.udp_chat_server_protocol:Unknown remote address, creating a  c2wServerProtocol instance for address ('127.0.0.1', 10001)
DEBUG:c2w.protocol.stop_wait:Registering KeepAlive=<bound method c2wServerProtocol.keepAliveTimeOutOccured of <c2w.protocol.server.c2wServerProtocol object at 0x7f854371ef98>>
DEBUG:c2w.protocol.server:
handlePacket
DEBUG:c2w.protocol.server:  message dump: b'0001000c616dc3a964c3a965'
DEBUG:c2w.protocol.message:Received a Login request (len=8)
DEBUG:c2w.protocol.message:-> user name:amédée
DEBUG:c2w.protocol.server:received non-ack message
DEBUG:c2w.protocol.message:building ACK with ack_num=0 
DEBUG:c2w.protocol.message:Written header: b'00ff0004' (len=4)
DEBUG:c2w.protocol.message:Written header: b'00ff0004' (len=4)
DEBUG:c2w.protocol.stop_wait:ACK Message sent in UDP: len=4
DEBUG:c2w.protocol.stop_wait:  message dump: b'00ff0004'
DEBUG:c2w.protocol.server:handleNonAck
DEBUG:c2w.protocol.stop_wait:Received message with correct seq#=0
DEBUG:c2w.protocol.server:calling handleLoginRequest
DEBUG:c2w.main.user:USER_STORE (addUSer): adding user with name amédée to the dictionary
DEBUG:c2w.protocol.server:Send user status (connection accept) to user amédée (userId=2).
DEBUG:c2w.protocol.message:building Login OK message
DEBUG:c2w.protocol.message:Written header: b'00020004' (len=4)
DEBUG:c2w.protocol.message:Written header: b'00020004' (len=4)
DEBUG:c2w.protocol.stop_wait:sendMsg, empty queue, sending message with  wit seqNum=0 immediately
DEBUG:c2w.protocol.stop_wait:self.callLateId=<DelayedCall 0x7f854371e9e8 [2.0s] called=0 cancelled=0 c2wStopAndWait.timeOut()>
DEBUG:c2w.protocol.stop_wait:Message sent in UDP: len=4
DEBUG:c2w.protocol.stop_wait:  message dump: b'00020004'
DEBUG:c2w.protocol.server:Building user list messages:
DEBUG:c2w.protocol.message:building user list
DEBUG:c2w.protocol.message:Written header: b'00110004' (len=4)
DEBUG:c2w.protocol.message:   user: amédée   room=<class 'c2w.main.constants.ROOM_IDS.MAIN_ROOM'>   destRoom=<class 'c2w.main.constants.ROOM_IDS.MAIN_ROOM'>
DEBUG:c2w.protocol.message:   user: amédée   payload_len=10
DEBUG:c2w.protocol.message:   user: frédéric   room=<class 'c2w.main.constants.ROOM_IDS.MAIN_ROOM'>   destRoom=<class 'c2w.main.constants.ROOM_IDS.MAIN_ROOM'>
DEBUG:c2w.protocol.message:   user: frédéric   payload_len=22
DEBUG:c2w.protocol.message:   number of users in list: 2
DEBUG:c2w.protocol.message:   len of userlist payload: 22
DEBUG:c2w.protocol.message:   m.buf: 4, m.msg_len 26
DEBUG:c2w.protocol.message:Written header: b'0111001a0841616dc3a964c3a9650a416672c3a964c3a9726963' (len=26)
DEBUG:c2w.protocol.stop_wait:sendMsg, current queue length=1, queueing  message wit seqNum=1
DEBUG:c2w.protocol.message:building movie list
DEBUG:c2w.protocol.message:   movie: 3 Days to Kill   payload_len=21
DEBUG:c2w.protocol.message:Written header: b'00120019000000000000000000000000000000000000000000' (len=25)
DEBUG:c2w.protocol.message:   number of movies in list: 1
DEBUG:c2w.protocol.message:   len of movielist payload: 21
DEBUG:c2w.protocol.message:   m.buf: 25, m.msg_len 25
DEBUG:c2w.protocol.message:Written header: b'021200190e000000004e2033204461797320746f204b696c6c' (len=25)
DEBUG:c2w.protocol.stop_wait:sendMsg, current queue length=2, queueing  message wit seqNum=2
edge_id = 1
action is 0001000e6672c3a964c3a9726963
{'type': 'Login', 'ack': False, 'data_length': 10, 'user_name': 'frédéric', 'payload': b'fr\xc3\xa9d\xc3\xa9ric', 'seq_num': 0}
client_id = 1
hex_v is 00ff0004
Test passed
client_id = 1
hex_v is 00020004
Test passed
edge_id = 1
action is 00ff0004
client_id = 1
hex_v is 011100100a416672c3a964c3a9726963
Test passed
edge_id = 1
action is 01ff0004
client_id = 1
hex_v is 021200190e000000004e2033204461797320746f204b696c6c
Test passed
edge_id = 1
action is 02ff0004
edge_id = 2
action is 0001000c616dc3a964c3a965
{'type': 'Login', 'ack': False, 'data_length': 8, 'user_name': 'amédée', 'payload': b'am\xc3\xa9d\xc3\xa9e', 'seq_num': 0}
client_id = 1
hex_v is 031100100a416672c3a964c3a9726963
                       [FAIL]

===============================================================================
[FAIL]
Traceback (most recent call last):
  File "/home/jean/git/c2w-sibyl/src/c2w/test/protocol/udp_server_test.py", line 155, in test_generic
    self.test_automata()
  File "/home/jean/git/c2w-sibyl/src/c2w/test/protocol/udp_server_test.py", line 137, in test_automata
    self.assertFalse(bad_client_id, "Bad client identification")
  File "/usr/local/lib/python3.4/dist-packages/twisted/trial/_synctest.py", line 389, in assertFalse
    super(_Assertions, self).assertFalse(condition, msg)
  File "/usr/lib/python3.4/unittest/case.py", line 648, in assertFalse
    raise self.failureException(msg)
twisted.trial.unittest.FailTest: True is not false : Bad client identification

c2w.test.protocol.udp_server_test.c2wUdpChatServerTestCase.test_two_users_full_login_udp_server_test
-------------------------------------------------------------------------------
Ran 1 tests in 0.015s

FAILED (failures=1)
